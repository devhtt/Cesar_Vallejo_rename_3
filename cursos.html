<!doctype html>
<html lang="es">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>Cursos</title>
	<style>
		body{font-family:Arial,Helvetica,sans-serif;margin:20px}
		.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
		.courses{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px}
		.card{border:1px solid #ddd;padding:12px;border-radius:6px;background:#fff;box-shadow:0 2px 4px rgba(0,0,0,0.1)}
		.card-author{display:flex;align-items:center;gap:8px;margin-bottom:12px;font-size:0.85rem}
		.card-author-avatar{width:36px;height:36px;border-radius:50%;background:#0078d4;color:#fff;display:flex;align-items:center;justify-content:center;font-weight:600;overflow:hidden;flex-shrink:0}
		.card-author-avatar img{width:100%;height:100%;object-fit:cover}
		.card-stats{display:flex;gap:12px;font-size:0.85rem;color:#666;margin:8px 0}
		.stat{display:flex;align-items:center;gap:4px}
		.button{padding:8px 12px;border-radius:4px;border:1px solid #0078d4;background:#0078d4;color:#fff;text-decoration:none;cursor:pointer;font-size:0.9rem}
		.button.secondary{background:#f3f3f3;color:#222;border-color:#ccc}
		.button.small{padding:6px 10px;font-size:0.85rem}
		.back-button{display:inline-flex;align-items:center;gap:4px;margin-bottom:16px}
	</style>
</head>
<body>
	<div class="back-button">
		<a class="button secondary" href="seleccion.html">‚Üê Volver</a>
	</div>

	<div class="header">
		<h1>Cursos publicados</h1>
		<div>
			<a class="button" href="nuevo_curso.html">+ Crear curso</a>
			<button id="refreshBtn" class="button secondary">Refrescar</button>
		</div>
	</div>

	<div id="emptyMsg" style="color:#666;margin-bottom:12px;display:none">No hay cursos publicados.</div>
	<div id="courses" class="courses">
		<!-- Cursos cargados din√°micamente -->
	</div>

	<script>
		// Cargar y renderizar cursos publicados desde localStorage
		function loadCourses() {
			const container = document.getElementById('courses');
			container.innerHTML = '';
			const all = JSON.parse(localStorage.getItem('cursos') || '[]');
			const published = all.filter(c => c.publicado);
			if (published.length === 0) {
				document.getElementById('emptyMsg').style.display = 'block';
				return;
			} else {
				document.getElementById('emptyMsg').style.display = 'none';
			}
			published.forEach(c => {
				const card = document.createElement('div');
				card.className = 'card';
				const imagen = c.imagenes && c.imagenes[0] ? (c.imagenes[0].data || c.imagenes[0]) : '';
				const fecha = c.fechaCreacion ? new Date(c.fechaCreacion).toLocaleDateString('es-ES') : 'N/A';
				const usuariosCount = (c.usuariosIngresados || []).length;
				
				let autorHTML = '';
				if (c.autor) {
					autorHTML = `
						<div class="card-author">
							<div class="card-author-avatar">
								${c.autorFoto ? `<img src="${escapeHtml(c.autorFoto)}" alt="${escapeHtml(c.autor)}" />` : c.autor.charAt(0).toUpperCase()}
							</div>
							<div>
								<p style="margin:0;font-weight:600">${escapeHtml(c.autor)}</p>
								<p style="margin:0;color:#999;font-size:0.8rem">${fecha}</p>
							</div>
						</div>
					`;
				}

				card.innerHTML = `
					${autorHTML}
					${imagen ? `<img src="${escapeHtml(imagen)}" alt="${escapeHtml(c.titulo)}" style="margin-top:8px">` : '<div style="height:160px;background:#f0f0f0;border-radius:4px;margin-top:8px"></div>'}
					<h3>${escapeHtml(c.titulo)}</h3>
					<div class="card-stats">
						<div class="stat">‚è±Ô∏è ${c.duracion || 0} min</div>
						<div class="stat">üë• ${usuariosCount} usuario${usuariosCount !== 1 ? 's' : ''}</div>
					</div>
					<p>${escapeHtml(c.contexto || '')}</p>
					<div class="actions">
						<a class="button small" href="ver_curso.html?id=${c.id}">Ver curso</a>
						<a class="button secondary small" href="nuevo_curso.html?id=${c.id}">Editar</a>
					</div>
				`;
				container.appendChild(card);
			});
		}

		// Peque√±a funci√≥n para escapar texto
		function escapeHtml(str) {
			if (!str) return '';
			return String(str)
				.replace(/&/g, '&amp;')
				.replace(/</g, '&lt;')
				.replace(/>/g, '&gt;')
				.replace(/"/g, '&quot;')
				.replace(/'/g, '&#39;');
		}

		document.getElementById('refreshBtn').addEventListener('click', loadCourses);
		window.addEventListener('load', loadCourses);
	</script>
</body>
</html>